<main>
  <h1>Frutas similares al lichi</h1>

  <p>
    Una vez afirmé que lichi, rambután y mamoncillo eran básicamente lo mismo.
    Esta página es una respuesta más cuidadosa.
  </p>

  <h2>Contexto taxonómico</h2>

  <p>
    La mayoría de las frutas similares al lichi que se muestran en esta página pertenecen a la familia 
    <strong>Sapindaceae</strong> (familia de las sapindáceas). 
    Esta familia se encuentra dentro del orden <strong>Sapindales</strong>.
  </p>

  <p>
    La familia Sapindaceae contiene aproximadamente 140 géneros y casi 2.000 especies,
    incluyendo muchas frutas tropicales. Aunque pueden parecer similares, la similitud que comparten
    se debe a relaciones evolutivas a nivel de familia, no de especie.
  </p>

  <h2>Géneros y especies seleccionadas</h2>

  <h3>Sapindaceae (familia de las sapindáceas)</h3>
  <ul>
    <li><a href="https://es.wikipedia.org/wiki/Litchi_chinensis" target="_blank"><em>Litchi chinensis</em></a> — lichi  
        (<a href="https://www.youtube.com/watch?v=JbDL0fQ-Tgg" target="_blank">video comparación</a>)</li>
    <li><a href="https://es.wikipedia.org/wiki/Nephelium_lappaceum" target="_blank"><em>Nephelium lappaceum</em></a> — rambután  
        (<a href="https://www.youtube.com/watch?v=uouRC7GnEXE" target="_blank">video sabor</a>)</li>
    <li><a href="https://es.wikipedia.org/wiki/Nephelium_mutabile" target="_blank"><em>Nephelium mutabile</em></a> — pulasan</li>
    <li><a href="https://en.wikipedia.org/wiki/Melicoccus_bijugatus" target="_blank"><em>Melicoccus bijugatus</em></a> — mamoncillo</li>
    <li><a href="https://es.wikipedia.org/wiki/Dimocarpus_longan" target="_blank"><em>Dimocarpus longan</em></a> — longan</li>
    <li><a href="https://es.wikipedia.org/wiki/Pometia_pinnata" target="_blank"><em>Pometia pinnata</em></a> — korlan / matoa</li>
    <li><a href="https://es.wikipedia.org/wiki/Blighia_sapida" target="_blank"><em>Blighia sapida</em></a> — ackee</li>
    <li><a href="https://es.wikipedia.org/wiki/Paullinia_cupana" target="_blank"><em>Paullinia cupana</em></a> — guaraná</li>
    <li><a href="https://es.wikipedia.org/wiki/Sapindus" target="_blank"><em>Sapindus</em></a> spp. — soapberries</li>
    <li><a href="https://es.wikipedia.org/wiki/Acer" target="_blank"><em>Acer</em></a> spp. — arces</li>
    <li><a href="https://es.wikipedia.org/wiki/Aesculus" target="_blank"><em>Aesculus</em></a> spp. — castaños de indias</li>
    <li><a href="https://es.wikipedia.org/wiki/Schleichera_trijuga" target="_blank"><em>Schleichera trijuga</em></a> — aceite de Macasar</li>
    <li><a href="https://es.wikipedia.org/wiki/Koelreuteria" target="_blank"><em>Koelreuteria</em></a>, 
        <a href="https://es.wikipedia.org/wiki/Cardiospermum" target="_blank"><em>Cardiospermum</em></a>, 
        <a href="https://es.wikipedia.org/wiki/Ungnadia" target="_blank"><em>Ungnadia</em></a> — ornamentales</li>
  </ul>

  <h3>Clusiaceae</h3>
  <ul>
    <li><a href="https://es.wikipedia.org/wiki/Garcinia_mangostana" target="_blank"><em>Garcinia mangostana</em></a> — mangostán</li>
    <li><a href="https://es.wikipedia.org/wiki/Garcinia_gummi-gutta" target="_blank"><em>Garcinia gummi-gutta</em></a> — tamarindo malabar</li>
  </ul>

  <h3>Annonaceae</h3>
  <ul>
    <li><a href="https://es.wikipedia.org/wiki/Annona_muricata" target="_blank"><em>Annona muricata</em></a> — guanábana</li>
    <li><a href="https://es.wikipedia.org/wiki/Annona_squamosa" target="_blank"><em>Annona squamosa</em></a> — chirimoya</li>
    <li><a href="https://es.wikipedia.org/wiki/Annona_reticulata" target="_blank"><em>Annona reticulata</em></a> — atemoya</li>
  </ul>

  <h2>Tabla de distancias taxonómicas</h2>
  <p>
    Esta tabla compara cuán cercanas están estas especies evolutivamente usando pasos en la clasificación. 
    Las celdas en rosa indican frutas consideradas “similares al lichi” (incluyendo algunas fuera de Sapindaceae).
    Los valores indican la distancia en pasos desde especie → género → subfamilia → familia → orden → phylum.
  </p>

  <table id="distance-table" border="1" style="border-collapse: collapse;">
    <thead>
      <tr>
        <th>Especie</th>
        <th>Lichi</th>
        <th>Rambután</th>
        <th>Mamoncillo</th>
        <th>Longan</th>
        <th>Pulasan</th>
        <th>Ackee</th>
        <th>Guaraná</th>
        <th>Korlan</th>
        <th>Soapberries</th>
        <th>Arce</th>
        <th>Castaño de indias</th>
        <th>Mangostán</th>
        <th>Guanábana</th>
        <th>Chirimoya</th>
        <th>Atemoya</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Árbol taxonómico interactivo</h2>
  <p>Hover sobre cada nodo para ver subfamilia, género y si es fruta similar al lichi.</p>
  <div id="tree"></div>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const taxa = {
      "Lichi": { order:"Sapindales", family:"Sapindaceae", subfamily:"Sapindoideae", genus:"Litchi", species:"chinensis", lycheeLike:true },
      "Rambután": { order:"Sapindales", family:"Sapindaceae", subfamily:"Sapindoideae", genus:"Nephelium", species:"lappaceum", lycheeLike:true },
      "Mamoncillo": { order:"Sapindales", family:"Sapindaceae", subfamily:"Sapindoideae", genus:"Melicoccus", species:"bijugatus", lycheeLike:true },
      "Longan": { order:"Sapindales", family:"Sapindaceae", subfamily:"Sapindoideae", genus:"Dimocarpus", species:"longan", lycheeLike:true },
      "Pulasan": { order:"Sapindales", family:"Sapindaceae", subfamily:"Sapindoideae", genus:"Nephelium", species:"mutabile", lycheeLike:true },
      "Ackee": { order:"Sapindales", family:"Sapindaceae", subfamily:"Sapindoideae", genus:"Blighia", species:"sapida", lycheeLike:true },
      "Guaraná": { order:"Sapindales", family:"Sapindaceae", subfamily:"Sapindoideae", genus:"Paullinia", species:"cupana", lycheeLike:true },
      "Korlan": { order:"Sapindales", family:"Sapindaceae", subfamily:"Sapindoideae", genus:"Pometia", species:"pinnata", lycheeLike:true },
      "Soapberries": { order:"Sapindales", family:"Sapindaceae", subfamily:"Sapindoideae", genus:"Sapindus", species:"spp", lycheeLike:true },
      "Arce": { order:"Sapindales", family:"Sapindaceae", subfamily:"Hippocastanoideae", genus:"Acer", species:"spp", lycheeLike:false },
      "Castaño de indias": { order:"Sapindales", family:"Sapindaceae", subfamily:"Hippocastanoideae", genus:"Aesculus", species:"spp", lycheeLike:false },
      "Mangostán": { order:"Malpighiales", family:"Clusiaceae", subfamily:"", genus:"Garcinia", species:"mangostana", lycheeLike:true },
      "Guanábana": { order:"Magnoliales", family:"Annonaceae", subfamily:"", genus:"Annona", species:"muricata", lycheeLike:true },
      "Chirimoya": { order:"Magnoliales", family:"Annonaceae", subfamily:"", genus:"Annona", species:"squamosa", lycheeLike:true },
      "Atemoya": { order:"Magnoliales", family:"Annonaceae", subfamily:"", genus:"Annona", species:"reticulata", lycheeLike:true }
    };

    const levels = ["order","family","subfamily","genus","species"];
    const tbody = document.querySelector("#distance-table tbody");
    const names = Object.keys(taxa).sort((a,b)=>{
      if(taxa[a].family === taxa[b].family) return taxa[a].genus.localeCompare(taxa[b].genus);
      return taxa[a].family.localeCompare(taxa[b].family);
    });

    names.forEach(row => {
      const tr = document.createElement("tr");
      const th = document.createElement("th");
      th.textContent = row;
      tr.appendChild(th);

      names.forEach(col => {
        const td = document.createElement("td");
        let d = levels.length * 2; // default max
        for(let i=levels.length-1;i>=0;i--){
          if(taxa[row][levels[i]] && taxa[row][levels[i]]===taxa[col][levels[i]]){
            d = 2*(levels.length-1-i);
            break;
          }
        }
        td.textContent = d;
        if(taxa[row].lycheeLike && taxa[col].lycheeLike) td.style.backgroundColor="#fde0dc";
        td.title = `Nivel común más alto: ${levels[levels.length - d/2 - 1] || "ninguno"}\nGénero: ${taxa[col].genus}\nSubfamilia: ${taxa[col].subfamily}`;
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
  });

  // D3 tree
  const treeData = {
    name:"Plantas con flores",
    children:[
      {name:"Sapindales", children:[
        {name:"Sapindaceae", children:[
          {name:"Sapindoideae", children:[
            {name:"Lichi", info:{genus:"Litchi", subfamily:"Sapindoideae", lycheeLike:true}},
            {name:"Rambután", info:{genus:"Nephelium", subfamily:"Sapindoideae", lycheeLike:true}},
            {name:"Mamoncillo", info:{genus:"Melicoccus", subfamily:"Sapindoideae", lycheeLike:true}},
            {name:"Longan", info:{genus:"Dimocarpus", subfamily:"Sapindoideae", lycheeLike:true}},
            {name:"Pulasan", info:{genus:"Nephelium", subfamily:"Sapindoideae", lycheeLike:true}},
            {name:"Ackee", info:{genus:"Blighia", subfamily:"Sapindoideae", lycheeLike:true}},
            {name:"Guaraná", info:{genus:"Paullinia", subfamily:"Sapindoideae", lycheeLike:true}},
            {name:"Korlan", info:{genus:"Pometia", subfamily:"Sapindoideae", lycheeLike:true}},
            {name:"Soapberries", info:{genus:"Sapindus", subfamily:"Sapindoideae", lycheeLike:true}}
          ]},
          {name:"Hippocastanoideae", children:[
            {name:"Arce", info:{genus:"Acer", subfamily:"Hippocastanoideae", lycheeLike:false}},
            {name:"Castaño de indias", info:{genus:"Aesculus", subfamily:"Hippocastanoideae", lycheeLike:false}}
          ]}
        ]}
      ]},
      {name:"Malpighiales", children:[
        {name:"Clusiaceae", children:[
          {name:"Mangostán", info:{genus:"Garcinia", lycheeLike:true}},
          {name:"Tamarindo malabar", info:{genus:"Garcinia", lycheeLike:false}}
        ]}
      ]},
      {name:"Magnoliales", children:[
        {name:"Annonaceae", children:[
          {name:"Guanábana", info:{genus:"Annona", lycheeLike:true}},
          {name:"Chirimoya", info:{genus:"Annona", lycheeLike:true}},
          {name:"Atemoya", info:{genus:"Annona", lycheeLike:true}}
        ]}
      ]}
    ]
  };

  const width = 1000, height = 600;
  const svg = d3.select("#tree").append("svg").attr("width",width).attr("height",height)
    .append("g").attr("transform","translate(100,50)");

  const root = d3.hierarchy(treeData);
  const treeLayout = d3.tree().size([height-100, width-200]);
  treeLayout(root);

  // links
  svg.selectAll('line.link')
    .data(root.links())
    .enter()
    .append('line')
    .classed('link',true)
    .attr('x1',d=>d.source.y)
    .attr('y1',d=>d.source.x)
    .attr('x2',d=>d.target.y)
    .attr('y2',d=>d.target.x)
    .attr('stroke','#555');

  // nodes
  const node = svg.selectAll('g.node')
    .data(root.descendants())
    .enter()
    .append('g')
    .attr('class','node')
    .attr('transform', d=>`translate(${d.y},${d.x})`);

  node.append('circle')
    .attr('r',6)
    .attr('fill', d=>d.data.info?.lycheeLike ? "#fde0dc" : "#555")
    .on('mouseover', function(event,d){
      const info = d.data.info || {};
      const tooltip = `Nombre: ${d.data.name}\nGénero: ${info.genus || "-"}\nSubfamilia: ${info.subfamily || "-"}\nLychee-like: ${info.lycheeLike ? "Sí":"No"}`;
      console.log(tooltip);
    });

  node.append('text')
    .attr('x',10)
    .attr('y',4)
    .text(d=>d.data.name)
    .style('font-family','sans-serif')
    .style('font-size','12px');
  </script>
</main>
